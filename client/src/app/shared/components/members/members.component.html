<ng-container *ngIf="form$ | async as form">
  <form [formGroup]="form" (ngSubmit)="save(form.getRawValue())">

    <h1 mat-dialog-title>Members</h1>

    <mat-dialog-content class="ta-center">
      <div class="flex ai-base" *ngFor="let control of getMembers(form).controls; index as index;" [formGroup]="control">
        <mat-form-field appearance="outline" class="f1">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" />
        </mat-form-field>&nbsp;
        <mat-form-field appearance="outline" class="f1">
          <mat-label>Role</mat-label>
          <mat-select formControlName="role">
            <mat-option *ngFor="let r of role | keyvalue" [value]="r.value">{{r.key}}</mat-option>
          </mat-select>
        </mat-form-field>
        <button mat-icon-button color="warn" type="button" (click)="removeMember(form, index)">
          <mat-icon>cancel</mat-icon>
        </button>
      </div>
      <button type="button" mat-stroked-button (click)="addMember(form)">
        <mat-icon>add</mat-icon>
        <span>&nbsp;Add new member</span>
      </button>
    </mat-dialog-content>

    <mat-dialog-actions class="jc-end">
      <button mat-button [mat-dialog-close]>Cancel</button>&nbsp;
      <button [class.loading]="loading$ | async" mat-flat-button color="primary">Save changes</button>
    </mat-dialog-actions>

  </form>
</ng-container>
